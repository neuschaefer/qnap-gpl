<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Riccardo Facchetti">
   <meta name="GENERATOR" content="Mozilla/4.74 [en] (X11; U; Linux 2.4.3 i586) [Netscape]">
</head>
<body text="#000000" bgcolor="#FFFFFF" link="#0000EF" vlink="#51188E" alink="#FF0000">

<h2>
Smart UPSes</h2>
&nbsp;
<h3>
<a NAME="BackUPS Pro"></a>BackUPS Pro</h3>

<p><br>/***************************************************************************/
<br>/* README.BackUPS-Pro Users of apcupsd */
<br>/* BY: "Christopher J. Reimer" &lt;reimer@doe.carleton.ca> */
<br>/* "Andre M. Hedrick" &lt;hedrick@astro.dyer.vanderbilt.edu> */
<br>/***************************************************************************/
<p>BackUPS Pro series users:
<p>/***************************************************************************/
<br>/* #940-0095A cable is smart mode only ??? */
<br>/***************************************************************************/
<p>Tues, July 8 1997
<br>From : hedrick@astro.dyer.vanderbilt.edu
<p>N-th hack at cable #940-0095A.
<br>I theory and test on a bread board, I got the !@#$%&amp; thing to work,
<br>but noluck with a plain jane BackUPS. Will try to get it to work with
<br>a SmartUPS. Anyone want to try the dumb mode code?
<p>/***************************************************************************/
<br>/* #940-0020B cable is dumb mode only. */
<br>/***************************************************************************/
<p>Date: Thu, 22 May 1997 13:34:49 -0600
<br>From: Eric Jones &lt;ejones@rap.ucar.edu>
<br>To: hedrick@astro.dyer.vanderbilt.edu
<br>Subject: apcupsd
<p>Hi,
<p>I just wanted to report an (almost) success story. I'm running your
<br>apcupsd using an APC BackUPS Pro. I used the 940-0020B cables.
<p>I'm trying to run it under Debian Linux which uses Sys V style init.
Do
<br>you have any info on how to do this correctly? If I figure it out I'll
<br>forward the info on to you. The daemon works perfectly though. It
<br>detects loss of power and shuts down only when the battery is low.
<p>Thanks,
<p>Eric Jones
<p>ejones@ucar.edu
<br>&nbsp;
<br>&nbsp;
<p>/***************************************************************************/
<br>/* #940-0024(B/C) cable is smart mode only. */
<br>/***************************************************************************/
<p>Note:
<br>I called APC and they claim that the command language for SmartUPSs
and
<br>BackUPS Pro models are different. I don't know the results if you try
<br>to run this daemon with a BackUPS Pro. I assume that there is no harm
<br>since is an ASCII command set.
<p>i.e
<p>You send a character and then poll for the response.
<p>From: Karsten Wiborg &lt;4wiborg@informatik.uni-hamburg.de>
<p>A -> invokes the testing of the LEDs
<br>G -> gives T when power failure and S if not
<br>Q -> returns 08 if the Online-LED is on and 10 if the on-battery LED
<br>is on. It also returns 50 if the battery power is almost
<br>used up and the UPS starts beeping without pause.
<br>R -> ends the communication between UPS and computer. The UPS
<br>tells the computer BYE
<br>S -> returns NA
<br>U -> does a power failure test
<br>W -> switches the UPS on battery but returns online after a short time
<br>X -> returns online after a W-command
<br>Y -> does something I don't know what probably Attention like you
<br>described
<br>a -> returns a bunch of wild characters I have no idea of
<br>b -> returns the firmware revision (in my case 21.L.I)
<br>n -> returns the serial number
<br>y -> returns (c) APCC
<br>8 -> returns 00
<br>9 -> returns FF
<br>- -> returns NO
<br>+ -> returns NO
<br>' -> returns 00
<br>@222 -> returns OK
<p>The UPS itself sends a ! when the power fails and a $ if the power
<br>returns. The UPS does NOT send a % if the battery is low. It also
<br>does NOT seem to send a + if the battery is recharged enough.
<br>It does send continuously ! in maybe 30second-intervals as long as
<br>the power is gone.
<br>So in order to safely shutdown LinuX, one has to immediately send
<br>the Q-command to the UPS as soon as the UPS itself sends the ! to
<br>the computer. As long as the UPS returns 10 the battery is okay but
<br>as soon as the UPS returns 50, we are in trouble and LinuX has to
<br>be shutdown ASAP !!! So we have to send the Q-command continuously
<br>to poll for the UPS-information.
<p>From: "Christopher J. Reimer" &lt;reimer@doe.carleton.ca>
<p>Also, could you put an option into apcupsd that uses
<br>the @ option, which I explain below, similar to the kill_power option.
<p>f Does not work
<br>N "
<br>M "
<br>Q same as smart ups. some of your missing bits will be telling
<br>you smart trim and smart boost info, but I have not seen this
<br>happen as of yet.
<br>P does not work
<br>F "
<br>L "
<br>O "
<br>C "
<br>B "
<br>Y same as smart ups, sort of , bring the ups into smartmode
<br>R put the ups into dumb mode
<br>W same as smart ups
<br>X same as smartups, but some funny responses
<br>power on sleep mode ups off
<br>NO NG (does not turn on) OK (does not turn on)
<br>U same as smart ups, responds with OK, if not in sleep mode or off,
<br>then it replies NA
<br>A same as smart ups responds OK
<br>^a ups type
<br>a some weird string
<br>Z ~1.5 sec Z does not work
<br>D does not work
<br>V "
<br>c "
<br>k "
<br>l "
<br>m "
<br>n serial #
<br>o does not work
<br>p "
<br>r "
<br>s "
<br>u "
<br>x "
<br>y same as smart ups
<br>7 does not work
<br>8 always reports 00
<br>9 always reports FF (the windows 95 monitoring software is always sending
<br>this to the ups ???)
<br>- always says no
<br>S soft shutdown, ups goes back online when power comes on line,
<br>at least it does with a good battery
<br>@xxy go into sleep mode after delay, and come on again in xx hours
and
<br>y * 6 minutes
<br>G same as smartups, but also it returns L if there was a power outage
<br>during sleep mode
<br>K ~1.5ms K same as smart-ups
<br>&nbsp;
<p>Also, the ups puts out certain characters due to various
<br>conditions
<p>? right after power-up
<br>! power-fail on battery
<br>$ back on line
<br>% or - indicates discharged battery
<br>+ indicates batteries recharged
<br>&nbsp;
<p>/***************************************************************************/
<br>&nbsp;
<h3>
<a NAME="BackUPS Pro (new version)"></a>BackUPS Pro (new version)</h3>

<p><br>/***************************************************************************/
<br>/* README.NewerBackUPS-Pro Users of apcupsd */
<br>/* "Andre M. Hedrick" &lt;hedrick@astro.dyer.vanderbilt.edu> */
<br>/***************************************************************************/
<p>Newer BackUPS Pro series users:
<p>This a newer version is my best guess......it has almost all of the
<br>features of the Smart UPS series less the "temp" and "dip switches"
<br>I believe that the difference is the serial number series.
<p>Mine (donated by A.S.A. Computers) has this serial number: 'FB9742936193'
<p>The way to test is to try both modes.
<p>UPSTYPE newbackupspro :: returns for cat /etc/apcupsd.status
<p>APC : Jan 27 16:18:25
<br>CABLE : APC Cable 940-0095A
<br>UPSMODEL : Smarter BackUPS Pro
<br>UPSMODE : Stand Alone
<br>ULINE : 123.8 Volts
<br>MLINE : 124.5 Volts
<br>NLINE : 123.8 Volts
<br>FLINE : 60.0 Hz
<br>VOUTP : 123.8 Volts
<br>LOUTP : 016.2
<br>BOUTP : 13.8 Volts
<br>BCHAR : 100.0
<br>BFAIL : 0x08
<br>UPSTYPE backupspro :: returns for cat /etc/apcupsd.status
<br>APC : Jan 27 16:20:51
<br>CABLE : APC Cable 940-0095A
<br>UPSMODEL : BackUPS Pro
<br>UPSMODE : Stand Alone
<br>LINEFAIL : OK
<br>BATTSTAT : OK
<br>MAINS    : OK
<br>LASTEVNT : POWER FAILURE
<p>Yes, all I did was change the "UPSTYPE" for this example.
<br>If you do not have a "newbackupspro", the top example will return
<br>garbage.......
<p>/***************************************************************************/
<br>&nbsp;
<h3>
<a NAME="SmartUPS v/s"></a>SmartUPS v/s</h3>

<p><br>/***************************************************************************/
<br>/* README.SmartUPS-VS Users of apcupsd */
<br>/* "Andre M. Hedrick" &lt;hedrick@astro.dyer.vanderbilt.edu> */
<br>/***************************************************************************/
<p>SmartUPS v/s series users:
<br>See BackUPS Pro
<p>/***************************************************************************/
<br>&nbsp;
</body>
</html>
