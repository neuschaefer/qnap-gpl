From MAILER-DAEMON Fri Jan 28 20:39:12 2000
Date: Fri, 28 Jan 2000 20:39:12 +0100 (CET)
From: Mail System Internal Data <MAILER-DAEMON@master.oasi.gpa.it>
Subject: DON'T DELETE THIS MESSAGE -- FOLDER INTERNAL DATA
X-IMAP: 0949088352 0000000000
Status: RO

This text is part of the internal format of your mail folder, and is not
a real message.  It is created automatically by the mail system software.
If deleted, important folder data will be lost, and it will be re-created
with the data reset to initial values.

From riccardo@master.oasi.gpa.it Thu Jan 27 19:12:15 2000 +0100
Status: R
X-Status: 
X-Keywords:
Return-Path: <doug@incline.com>
Received: from master.oasi.gpa.it
	by localhost with POP3 (fetchmail-5.0.3)
	for riccardo@localhost (single-drop); Thu, 27 Jan 2000 19:12:15 +0100 (CET)
Received: from seaview.incline.com (dialupB159.vncr.uswest.net [207.225.93.159])
	by master.oasi.gpa.it (8.9.3/8.9.3) with ESMTP id RAA04619
	for <riccardo@master.oasi.gpa.it>; Thu, 27 Jan 2000 17:48:12 +0100
Received: from spokane (spokane.incline.com [192.168.0.5])
	by seaview.incline.com (Postfix) with SMTP
	id 7082295A4; Thu, 27 Jan 2000 08:47:58 -0800 (PST)
From: "Doug Forman" <doug@incline.com>
To: <brisse@acm.org>,
        "Riccardo Fachetti (E-mail)" <riccardo@master.oasi.gpa.it>
Subject: apcupsd
Date: Thu, 27 Jan 2000 08:47:23 -0800
Message-ID: <NCBBKINDALONIJBBKELBAEGJEFAA.doug@incline.com>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2910.0)
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2919.6700
Importance: Normal
X-UIDL: 3cca2bf748c54e934e37b94e0493f183

Hi Brian,

The forwarded message was getting to be a real mess and quite difficult to
read, so I'm sending a "clean" copy of my detailed reply to you and Riccardo
again.

>I'm sorry about the mailserver problems - seems your domain
>is on some sort of blacklist :)

My email server (Qube2 running Postfix/Fetchmail) is connected via a
full-time dynamic IP dial-up account.  Thus it does not [cannot] have a DNS
MX record.  If your [DEC] mailserver filters spam by doing reverse-DNS,
that's why!  (this reminds me of a change I can make to maybe improve this).
BTW, I was a "DECCIE" in the early 80's too!  It was a *very* different
company then - compared to now, I suspect...

Finally, a little more "FYI" - when running configure, make, etc on the
Qube2, it is not recognized as a RH52-based system.  I found it necessary to
use the RH install scripts as a template to manually copy and configure the
appropriate rc scripts on my system.  Works great, but not automatic.  One
primary difference is that make install places the binaries in
/usr/local/sbin/...  and the RH scripts are looking in /sbin/...  no
problem, just have to change either the Makefile or the rc scripts (which I
did manually anyway).

Cheers,

Doug

-----

Hi Brian,

Thanks for your prompt reply!

After reading your thoughts, here's a couple followup details to clarify
things:  my APC Powercell Network (circa 1995) UPS does *not* appear to be a
"smart" UPS.  The DB9 port wiring diagram, as described in the user guide,
indicates simple voltage levels as such:

UPS Pin   Direction   Purpose

1         <---        Accepts pulse input to shutdown UPS
2         --->        Line fail output (+5 when true, +0 when false)
3         --->        Line fail output (ground when true, open when false)
4         --->        Chassis Ground
5         --->        Low Batt output  (ground when true, open when false)
6         --->        Line fail output (open when true, ground when false)
7         --->        n/c
8         --->        n/c
9         --->        Chassis Ground

I am focusing on pin 5, "Low Batt output" which goes to ground when true.
The (skimpy) APC User's Manual doesn't describe this in detail, but says,
"...if the utility power is not restored to normal, the PowerCell will
eventually sound a loud tone to alert you that less than two minutes remain
before the UPS shuts down and ceases to power your equipment.  This is
called a LOW BATTERY CONDITION which means that the PowerCell's usable
battery capacity is nearly spent."  I suspect, but have not (yet) tested,
that the "Low Batt output" goes TRUE at this two-minute mark.  I also
suspect that the "two minute" measurement is based upon full [400W] load,
and would be MUCH longer on a very light load [25W] like mine.

Because the Qube2 takes only a few [45] seconds to completely HALT, and
because I should have 2+ hours of battery operation time, I'd like to send
infrequent user alerts, via DELAY and ANNOY settings, send an email alert to
a pager (using PWRCMD and RETCMD), and finally trigger a shutdown of the
Qube2 when Low Batt output goes true.

Does this make sense?  I think the BATTERYLEVEL and MINUTES switches which
you described below may only apply to "smart" UPS's?  Do they, or any other
switches, pay attention to the Low Batt output?

---

I really appreciate your help.  I am writing a series of articles on
upgrading and configuring a Cobalt Qube2, "The Road to Qube2," the first
four of which are posted on QubeQuorner (http://weblogs.userland.com/qube/).
In a future article, I'll be describing my entire UPS-interfacing
experience, posting a "how-to" description [including config files] to
assist others.  Obviously, I'd be happy to share any/all of this with you
also.

Thanks again,

Doug


> -----Original Message-----
> From: Brian Schau [mailto:Brian.Schau@Digital.com]
> Sent: Wednesday, January 26, 2000 1:43 AM
> To: 'Doug Forman'
> Subject: RE: apcupsd question
>
>
> Hi,
>
>
> First:	thanks for the kind words.	:)
> Second:
>
> I think you're looking for the BATTERYLEVEL or MINUTES
> switchs:
>
> BATTERYLEVEL
> -- <percent of battery>
> If BATTERYLEVEL is specified, during a power failure, apcupsd will
> shutdown the system when the remaining battery charge falls below the
> specified percentage.  The default is 5.
>
> MINUTES
> -- <battery runtime in minutes>
> If MINUTES is specified, during a power failure, apcupsd will
> shutdown the system when the remaining runtime on batteries
> as internally calculated by the UPS
> falls below the time specified. The default is 3.
>
> Please note though, that these switches generally causes much pain/trouble
> - mostly because people expects too much of them.   Play around with these
> switches, learn how to use them and you're set.
> (Hint: _don't_ set MINUTES lower than 3 (and certainly not 0! :), _don't_
> set BATTERYLEVEL lower than 5 (and certainly not 0! :))
>
> Kind regards,
>
>
> Brian
>
> > -----Original Message-----
> > From: Doug Forman [mailto:doug@incline.com]
> > Sent: Wednesday, January 26, 2000 10:05 AM
> > To: brisse@acm.org
> > Subject: apcupsd question
> >
> >
> > Greetings,
> >
> > After reading all of your helpful website, searching for an
> > answer to my
> > question, I now ask you:
> >
> > I am using an APC PowerCell Network (400W) UPS, which is
> > working properly
> > with apcupsd 3.6.2 on a Cobalt Qube2 (RH linux 2.0.34 / MIPS).  The
> > PowerCell model has a basic interface, which I am using with
> > the BACKUPS
> > setting and a 940-0095A cable.
> >
> > Question:  I see that BATTSTAT is being reported, along with
> > LINEFAIL.  My
> > Qube2 server is a *very* low power device (25W) attached to a
> > 400W UPS.
> > Rather than guess a (long!) TIMEOUT period, is there any way
> > to set the
> > system shutdown relative to the BATTSTAT?  i.e. when the
> > BATTSTAT changes
> > (indicating an imminent UPS shutdown?) then also shutdown the
> > server (it
> > takes less than 30sec to HALT)?  Or, do you think this is not
> > a good idea,
> > or have an alternate suggestion?
> >
> > Thanks very much for your time in answering this brief
> > question.  If I can
> > assist with further details, please ask!
> >
> > With kind regards,
> >
> > Doug
> >
> > ---
> > Doug Forman, MCSE, MCSD (doug@incline.com)
> > Incline Systems Inc - Vancouver, WA
> >
>
>

