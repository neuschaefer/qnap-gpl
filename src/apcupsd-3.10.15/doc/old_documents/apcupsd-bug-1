From riccardo@master.oasi.gpa.it Fri Feb 26 13:12:08 1999 +0100
Status: R
X-Status: A
X-Keywords:
Return-Path: <bsc@fleggaard.dk>
Received: from box1.tin.it
	by localhost with POP3 (fetchmail-4.7.4)
	for fizban@localhost (single-drop); Fri, 26 Feb 1999 13:12:07 +0100 (CET)
Received: from inetserver.fleggaard.dk ([195.249.86.10])
          by fep02-svc.tin.it (InterMail v4.0 201-221-105) with ESMTP
          id <19990226072015.BIOT24010.fep02-svc@inetserver.fleggaard.dk>
          for <riccardo@master.oasi.gpa.it>; Fri, 26 Feb 1999 08:20:15 +0100
Received: from DSERVER by inetserver.fleggaard.dk with SMTP (Microsoft Exchange Internet Mail Service Version 5.0.1457.7)
	id FVK8VMV9; Fri, 26 Feb 1999 08:20:11 +0100
Received: by dserver.fleggaard.dk with Internet Mail Service (5.5.2448.0)
	id <D6G6PH5A>; Fri, 26 Feb 1999 08:20:11 +0100
Message-ID: <1E60FE289E79D21187470060B06D7BD10E27A9@dserver.fleggaard.dk>
From: Brian Schau <bsc@fleggaard.dk>
To: "'riccardo@master.oasi.gpa.it'" <riccardo@master.oasi.gpa.it>
Subject: FW: apcupsd - no client shutdown
Date: Fri, 26 Feb 1999 08:20:10 +0100
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2448.0)
Content-Type: text/plain;
	charset="iso-8859-1"

Hi Riccardo,


Look what I found in my mailbox:  ;o)

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>>>>>>>>>
Hello!

Somehow master and slave of my apcupsd-network don't communicate
correctly. The slave's Magic is set, but the master claims that it cannot
read it. Here's detailed information:

I configured apcupsd according to the documentation:
master is connected to a Share-UPS, shuts itself down without problems
but does not manage to shut down its one client (I configured port 11011)

Base system is Suse 5.3 in both cases, I did install with the options suse
and libc5.

The log-file of the master says:
- that it found the client (on the right address)
- that it cannot read the client's magic

The slave's logfile is this: 

APC: Feb 25 19:55:18 read_struct_net(): incorrect read: read 0 bytes,
expected 92
APC: Feb 25 19:55:18 GFM APC    MAGIC is: x
APC: Feb 25 19:55:18 GFM MASTER MAGIC is: 
APC: Feb 25 19:55:18 GFM SLAVE  MAGIC is: aaaasaaaasaaaasaa
APC: Feb 25 19:55:18 LINEFAIL:OK BATTSTAT:OK
APC: Feb 25 19:55:51 read_struct_net(): incorrect read: read 0 bytes,
expected 92
APC: Feb 25 19:55:51 GFM APC    MAGIC is: 
APC: Feb 25 19:55:51 GFM MASTER MAGIC is: 
APC: Feb 25 19:55:51 GFM SLAVE  MAGIC is: aaaasaaaasaaaasaa
APC: Feb 25 19:55:51 LINEFAIL:OK BATTSTAT:OK
APC: Feb 25 19:56:24 read_struct_net(): incorrect read: read 0 bytes,
expected 92
APC: Feb 25 19:56:24 GFM APC    MAGIC is: 
APC: Feb 25 19:56:24 GFM MASTER MAGIC is: 
APC: Feb 25 19:56:24 GFM SLAVE  MAGIC is: aaaasaaaasaaaasaa
APC: Feb 25 19:56:24 LINEFAIL:OK BATTSTAT:OK
APC: Feb 25 19:56:57 read_struct_net(): incorrect read: read 0 bytes,
expected 92
APC: Feb 25 19:56:57 GFM APC    MAGIC is: 
APC: Feb 25 19:56:57 GFM MASTER MAGIC is: 
APC: Feb 25 19:56:57 GFM SLAVE  MAGIC is: aaaasaaaasaaaasaa
APC: Feb 25 19:56:57 LINEFAIL:OK BATTSTAT:OK
APC: Feb 25 19:57:30 read_struct_net(): incorrect read: read 0 bytes,
expected 92
APC: Feb 25 19:58:03 read_struct_net(): incorrect read: read 0 bytes,
expected 92
APC: Feb 25 19:58:03 GFM APC    MAGIC is: x
APC: Feb 25 19:58:03 GFM MASTER MAGIC is: 
APC: Feb 25 19:58:03 GFM SLAVE  MAGIC is: my_own_magic_1417
APC: Feb 25 19:58:03 LINEFAIL:OK BATTSTAT:OK
APC: Feb 25 19:58:36 read_struct_net(): incorrect read: read 0 bytes,
expected 92
APC: Feb 25 19:58:36 GFM APC    MAGIC is: 
APC: Feb 25 19:58:36 GFM MASTER MAGIC is: 
APC: Feb 25 19:58:36 GFM SLAVE  MAGIC is: my_own_magic_1417
APC: Feb 25 19:58:36 LINEFAIL:OK BATTSTAT:OK
APC: Feb 25 19:59:09 read_struct_net(): incorrect read: read 0 bytes,
expected 92
APC: Feb 25 19:59:09 GFM APC    MAGIC is: 
APC: Feb 25 19:59:09 GFM MASTER MAGIC is: 
APC: Feb 25 19:59:09 GFM SLAVE  MAGIC is: my_own_magic_1417
APC: Feb 25 19:59:09 LINEFAIL:OK BATTSTAT:OK
APC: Feb 25 19:59:42 read_struct_net(): incorrect read: read 0 bytes,
expected 92
APC: Feb 25 19:59:42 GFM APC    MAGIC is: 
APC: Feb 25 19:59:42 GFM MASTER MAGIC is: 
APC: Feb 25 19:59:42 GFM SLAVE  MAGIC is: my_own_magic_1417
APC: Feb 25 19:59:42 LINEFAIL:OK BATTSTAT:OK
APC: Feb 25 20:00:15 read_struct_net(): incorrect read: read 0 bytes,
expected 92
APC: Feb 25 20:00:15 GFM APC    MAGIC is: 
APC: Feb 25 20:00:15 GFM MASTER MAGIC is: 
APC: Feb 25 20:00:15 GFM SLAVE  MAGIC is: my_own_magic_1417
APC: Feb 25 20:00:15 LINEFAIL:OK BATTSTAT:OK

What I found interesting is the repeated error-message. Maybe this is a
hint what is wrong in my config?

I would be very glad if you could give me any sort of hint,
thanks in advance

Heiko Zimmer
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
<<<<<<<<<<<<<<<<<<<<<<<<


I did mention this bug when we made the turnover to 3.5.0.   Is it fixed
yet?   At that time, there was a mismatch in the structures.


Kind regards,


Brian

