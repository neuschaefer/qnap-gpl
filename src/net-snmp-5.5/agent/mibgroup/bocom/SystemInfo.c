/*
 * Note: this file originally auto-generated by mib2c using
 *        : mib2c.scalar.conf 17337 2009-01-01 14:28:29Z magfr $
 */

#include <net-snmp/net-snmp-config.h>
#include <net-snmp/net-snmp-includes.h>
#include <net-snmp/agent/net-snmp-agent-includes.h>
#include "SystemInfo.h"
#include "common.h"
//#include "../../../../NasLib/config/cfg_nic.h"

#define NIC_DEV_LEN		17      /* linux support up to 16 */
#define NIC_IPADDR_LEN		16
#define NIC_HWADDR_LEN		18

typedef struct
{
	char dev[NIC_DEV_LEN];  /* eth0 or eth1... */
        char hwaddr[NIC_HWADDR_LEN];    /* convert to string with : char */
        char ipaddr[NIC_IPADDR_LEN];
        char netmask[NIC_IPADDR_LEN];
        char gateway[NIC_IPADDR_LEN];
        char broadcast[NIC_IPADDR_LEN];
	char dstaddr[NIC_IPADDR_LEN];
} NIC_INFO;

int handle_NetType(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		int type = 25;
            snmp_set_var_typed_value(requests->requestvb, ASN_INTEGER, (u_char *)&type, sizeof(int));
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_SerialNumber(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
#define HWSERIALNUMBER "/var/hw_serial_number"
	if (reqinfo->mode == MODE_GET) {
		char sn[128];
		Get_Private_Profile_String("Hardware", "serial number", "null", sn, sizeof(sn), HWSERIALNUMBER);
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)sn, strlen(sn));
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_MibVersion(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		char *mib_ver = "1.1";
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)mib_ver, strlen(mib_ver));
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_Label(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		NIC_INFO nic;
		
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"TS-459U", 7);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_IPAddr(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		NIC_INFO nic;
		
		if (Get_NIC_Info_With_Default_Gateway(&nic) == 0)
			snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)nic.ipaddr, strlen(nic.ipaddr));
		else
			snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"--", 2);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_IPMask(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		NIC_INFO nic;
		
		if (Get_NIC_Info_With_Default_Gateway(&nic) == 0)
			snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)nic.netmask, strlen(nic.netmask));
		else
			snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"--", 2);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_IPGateway(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		NIC_INFO nic;
		
		if (Get_NIC_Info_With_Default_Gateway(&nic) == 0)
			snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)nic.gateway, strlen(nic.gateway));
		else
			snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"--", 2);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_MACAddr(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		NIC_INFO nic;
		
		if (Get_NIC_Info_With_Default_Gateway(&nic) == 0)
			snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)nic.hwaddr, strlen(nic.hwaddr));
		else
			snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"--", 2);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_SystemTime(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		time_t sys_time = time(NULL);
            snmp_set_var_typed_value(requests->requestvb, ASN_INTEGER, (u_char *)&sys_time, sizeof(int));
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_SystemOS(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		char buf[128] = "--";
		GetOneStringFromCommand("/bin/uname -s", buf, sizeof(buf));
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)buf, strlen(buf));
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_SystemKernelVersion(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		char buf[128] = "--";
		GetOneStringFromCommand("/bin/uname -r", buf, sizeof(buf));
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)buf, strlen(buf));
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}


int handle_HW_Ver(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"", 0);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_SW_Ver(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"", 0);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_Location(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"", 0);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_NTPUsed(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		int used = NTP_Is_Server_Used();
		snmp_set_var_typed_value(requests->requestvb, ASN_INTEGER, (u_char *)&used, sizeof(used));
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_NTPServer(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		char buf[1024] = "";
		NTP_Get_Server_IP(buf, sizeof(buf));
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)buf, strlen(buf));
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_Contact(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"", 0);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_ProdCode(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"", 0);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_Desc(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"", 0);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_TrapRecvIP(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"", 0);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_TrapRecvPort(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		int zero = 0;
		snmp_set_var_typed_value(requests->requestvb, ASN_INTEGER, (u_char *)&zero, sizeof(zero));
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}
int handle_SyncTime(netsnmp_mib_handler *handler,netsnmp_handler_registration *reginfo,netsnmp_agent_request_info* reqinfo,netsnmp_request_info *requests)
{
	if (reqinfo->mode == MODE_GET) {
		snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR, (u_char *)"", 0);
	}
	else {
            return SNMP_ERR_GENERR;
	}
	return SNMP_ERR_NOERROR;
}

/** Initializes the SystemInfo module */
void
init_SystemInfo(void)
{
    const oid NetType_oid[] = { NAS_ROOT_OID,2,1 };
    const oid SerialNumber_oid[] = { NAS_ROOT_OID,2,2 };
    const oid MibVersion_oid[] = { NAS_ROOT_OID,2,3 };
    const oid Label_oid[] = { NAS_ROOT_OID,2,6 };
    const oid IPAddr_oid[] = { NAS_ROOT_OID,2,8 };
    const oid IPMask_oid[] = { NAS_ROOT_OID,2,9 };
    const oid IPGateway_oid[] = { NAS_ROOT_OID,2,10 };
    const oid MACAddr_oid[] = { NAS_ROOT_OID,2,11 };
    const oid ModelName_oid[] = { NAS_ROOT_OID,2,16 };
    const oid SystemTime_oid[] = { NAS_ROOT_OID,2,18 };
    const oid SystemOS_oid[] = { NAS_ROOT_OID,2,24 };
    const oid SystemKernelVersion_oid[] = { NAS_ROOT_OID,2,25 };
    const oid HostName_oid[] = { NAS_ROOT_OID,2,26 };
    const oid SystemUptime_oid[] = { NAS_ROOT_OID,2,27 };

    const oid HW_Ver_oid[] = { NAS_ROOT_OID,2, 4};
    const oid SW_Ver_oid[] = { NAS_ROOT_OID,2, 5};
    const oid Location_oid[] = { NAS_ROOT_OID,2, 7};
    const oid NTPUsed_oid[] = { NAS_ROOT_OID,2, 12};
    const oid NTPServer_oid[] = { NAS_ROOT_OID,2, 13};
    const oid Contact_oid[] = { NAS_ROOT_OID,2, 15};
    const oid ProdCode_oid[] = { NAS_ROOT_OID,2, 16};
    const oid Desc_oid[] = { NAS_ROOT_OID,2, 19};
    const oid TrapRecvIP_oid[] = { NAS_ROOT_OID,2, 22};
    const oid TrapRecvPort_oid[] = { NAS_ROOT_OID,2, 23};
    const oid SyncTime_oid[] = { NAS_ROOT_OID,2, 33};
  DEBUGMSGTL(("SystemInfo", "Initializing\n"));

	REGISTER_SNMP_SCALE(NetType);
	REGISTER_SNMP_SCALE(SerialNumber);
	REGISTER_SNMP_SCALE(MibVersion);
	REGISTER_SNMP_SCALE(Label);
	REGISTER_SNMP_SCALE(IPAddr);
	REGISTER_SNMP_SCALE(IPMask);
	REGISTER_SNMP_SCALE(IPGateway);
	REGISTER_SNMP_SCALE(MACAddr);
	REGISTER_SNMP_SCALE(ModelName);
	REGISTER_SNMP_SCALE(SystemTime);
	REGISTER_SNMP_SCALE(SystemOS);
	REGISTER_SNMP_SCALE(SystemKernelVersion);
	REGISTER_SNMP_SCALE(HostName);
	REGISTER_SNMP_SCALE(SystemUptime);

	REGISTER_SNMP_SCALE(HW_Ver      );
	REGISTER_SNMP_SCALE(SW_Ver      );
	REGISTER_SNMP_SCALE(Location    );
	REGISTER_SNMP_SCALE(NTPUsed     );
	REGISTER_SNMP_SCALE(NTPServer   );
	REGISTER_SNMP_SCALE(Contact     );
	REGISTER_SNMP_SCALE(ProdCode    );
	REGISTER_SNMP_SCALE(Desc        );
	REGISTER_SNMP_SCALE(TrapRecvIP  );
	REGISTER_SNMP_SCALE(TrapRecvPort);
	REGISTER_SNMP_SCALE(SyncTime    );

/*
    netsnmp_register_scalar(
        netsnmp_create_handler_registration("SystemCPU-Usage", handle_SystemCPU_Usage,
                               SystemCPU_Usage_oid, OID_LENGTH(SystemCPU_Usage_oid),
                               HANDLER_CAN_RONLY
        ));
    netsnmp_register_scalar(
        netsnmp_create_handler_registration("SystemTotalMem", handle_SystemTotalMem,
                               SystemTotalMem_oid, OID_LENGTH(SystemTotalMem_oid),
                               HANDLER_CAN_RONLY
        ));
    netsnmp_register_scalar(
        netsnmp_create_handler_registration("SystemFreeMem", handle_SystemFreeMem,
                               SystemFreeMem_oid, OID_LENGTH(SystemFreeMem_oid),
                               HANDLER_CAN_RONLY
        ));
    netsnmp_register_scalar(
        netsnmp_create_handler_registration("SystemUptime", handle_SystemUptime,
                               SystemUptime_oid, OID_LENGTH(SystemUptime_oid),
                               HANDLER_CAN_RONLY
        ));
    netsnmp_register_scalar(
        netsnmp_create_handler_registration("CPU-Temperature", handle_CPU_Temperature,
                               CPU_Temperature_oid, OID_LENGTH(CPU_Temperature_oid),
                               HANDLER_CAN_RONLY
        ));
    netsnmp_register_scalar(
        netsnmp_create_handler_registration("SystemTemperature", handle_SystemTemperature,
                               SystemTemperature_oid, OID_LENGTH(SystemTemperature_oid),
                               HANDLER_CAN_RONLY
        ));
    netsnmp_register_scalar(
        netsnmp_create_handler_registration("IfNumber", handle_IfNumber,
                               IfNumber_oid, OID_LENGTH(IfNumber_oid),
                               HANDLER_CAN_RONLY
        ));
    netsnmp_register_scalar(
        netsnmp_create_handler_registration("HdNumber", handle_HdNumber,
                               HdNumber_oid, OID_LENGTH(HdNumber_oid),
                               HANDLER_CAN_RONLY
        ));
    netsnmp_register_scalar(
        netsnmp_create_handler_registration("ModelName", handle_ModelName,
                               ModelName_oid, OID_LENGTH(ModelName_oid),
                               HANDLER_CAN_RONLY
        ));
    netsnmp_register_scalar(
        netsnmp_create_handler_registration("HostName", handle_HostName,
                               HostName_oid, OID_LENGTH(HostName_oid),
                               HANDLER_CAN_RONLY
        ));
    netsnmp_register_scalar(
        netsnmp_create_handler_registration("SysFanNumber", handle_SysFanNumber,
                               SysFanNumber_oid, OID_LENGTH(SysFanNumber_oid),
                               HANDLER_CAN_RONLY
        ));
    netsnmp_register_scalar(
        netsnmp_create_handler_registration("SysVolumeNumber", handle_SysVolumeNumber,
                               SysVolumeNumber_oid, OID_LENGTH(SysVolumeNumber_oid),
                               HANDLER_CAN_RONLY
        ));
*/
}

int
handle_SystemCPU_Usage(netsnmp_mib_handler *handler,
                          netsnmp_handler_registration *reginfo,
                          netsnmp_agent_request_info   *reqinfo,
                          netsnmp_request_info         *requests)
{
    /* We are never called for a GETNEXT if it's registered as a
       "instance", as it's "magically" handled for us.  */

    /* a instance handler also only hands us one request at a time, so
       we don't need to loop over a list of requests; we'll only get one. */
	char string[256];
    
    switch(reqinfo->mode) {

        case MODE_GET:
		GetOneStringFromCommand("/usr/bin/top -c", string, sizeof(string));
		while (1) {
			char *ptr = strchr(string, '\n');
			if (ptr) *ptr = 0;
			else break;
		}

		int usage=(int)(atof(string)*100);
		snmp_set_var_typed_value(requests->requestvb, ASN_INTEGER, (u_char *)&usage, sizeof(usage));
//		strcat(string, " %");
//            snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR,
//                                     (u_char *) string/* XXX: a pointer to the scalar's data */,
//                                     strlen(string)/* XXX: the length of the data in bytes */);
            break;


        default:
            /* we should never get here, so this is a really bad error */
            snmp_log(LOG_ERR, "unknown mode (%d) in handle_SystemCPU-Usage\n", reqinfo->mode );
            return SNMP_ERR_GENERR;
    }

    return SNMP_ERR_NOERROR;
}
int
handle_SystemTotalMem(netsnmp_mib_handler *handler,
                          netsnmp_handler_registration *reginfo,
                          netsnmp_agent_request_info   *reqinfo,
                          netsnmp_request_info         *requests)
{
    /* We are never called for a GETNEXT if it's registered as a
       "instance", as it's "magically" handled for us.  */

    /* a instance handler also only hands us one request at a time, so
       we don't need to loop over a list of requests; we'll only get one. */
	char string[256];
    
    switch(reqinfo->mode) {

        case MODE_GET:
	{
	        *string = 0;
		FILE *fp = fopen("/proc/meminfo", "r");
		if (fp) {
			char buff[256];
			while (fgets(buff, sizeof(buff), fp)) {
				char *ptr;
				if ((ptr = strstr(buff, "MemTotal:"))) {
					snprintf(string, sizeof(string), "%.1f MB", ((float)atol(ptr+10))/1024);
					break;
				}
			}
			fclose(fp);
		}
    	}

            snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR,
                                     (u_char *) string/* XXX: a pointer to the scalar's data */,
                                     strlen(string)/* XXX: the length of the data in bytes */);
            break;


        default:
            /* we should never get here, so this is a really bad error */
            snmp_log(LOG_ERR, "unknown mode (%d) in handle_SystemTotalMem\n", reqinfo->mode );
            return SNMP_ERR_GENERR;
    }

    return SNMP_ERR_NOERROR;
}
int
handle_SystemFreeMem(netsnmp_mib_handler *handler,
                          netsnmp_handler_registration *reginfo,
                          netsnmp_agent_request_info   *reqinfo,
                          netsnmp_request_info         *requests)
{
    /* We are never called for a GETNEXT if it's registered as a
       "instance", as it's "magically" handled for us.  */

    /* a instance handler also only hands us one request at a time, so
       we don't need to loop over a list of requests; we'll only get one. */
    
	char string[256];
    switch(reqinfo->mode) {

        case MODE_GET:
	{
        *string = 0;
	FILE *fp = fopen("/proc/meminfo", "r");
	if (fp) {
		char buff[256];
		float freemem = 0.0;
		while (fgets(buff, sizeof(buff), fp)) {
			char *ptr;
			if ((ptr = strstr(buff, "MemFree:"))) {
				freemem += (float)atol(ptr+8);
			}
			else if ((ptr = strstr(buff, "Buffers:"))) {
				freemem += (float)atol(ptr+8);
			}
			else if ((ptr = strstr(buff, "Cached:"))) {
				freemem += (float)atol(ptr+7);
			}
		}
		snprintf(string, sizeof(string), "%.1f MB", freemem/1024);
		fclose(fp);
	}
	}
            snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR,
                                     (u_char *) string/* XXX: a pointer to the scalar's data */,
                                     strlen(string)/* XXX: the length of the data in bytes */);
            break;


        default:
            /* we should never get here, so this is a really bad error */
            snmp_log(LOG_ERR, "unknown mode (%d) in handle_SystemFreeMem\n", reqinfo->mode );
            return SNMP_ERR_GENERR;
    }

    return SNMP_ERR_NOERROR;
}
int
handle_SystemUptime(netsnmp_mib_handler *handler,
                          netsnmp_handler_registration *reginfo,
                          netsnmp_agent_request_info   *reqinfo,
                          netsnmp_request_info         *requests)
{
    /* We are never called for a GETNEXT if it's registered as a
       "instance", as it's "magically" handled for us.  */

    /* a instance handler also only hands us one request at a time, so
       we don't need to loop over a list of requests; we'll only get one. */
    
	long value = get_uptime();
    switch(reqinfo->mode) {

        case MODE_GET:
            snmp_set_var_typed_value(requests->requestvb, ASN_TIMETICKS,
                                     (u_char *) &value/* XXX: a pointer to the scalar's data */,
                                     sizeof(value)/* XXX: the length of the data in bytes */);
            break;


        default:
            /* we should never get here, so this is a really bad error */
            snmp_log(LOG_ERR, "unknown mode (%d) in handle_SystemUptime\n", reqinfo->mode );
            return SNMP_ERR_GENERR;
    }

    return SNMP_ERR_NOERROR;
}
int
handle_CPU_Temperature(netsnmp_mib_handler *handler,
                          netsnmp_handler_registration *reginfo,
                          netsnmp_agent_request_info   *reqinfo,
                          netsnmp_request_info         *requests)
{
    /* We are never called for a GETNEXT if it's registered as a
       "instance", as it's "magically" handled for us.  */

    /* a instance handler also only hands us one request at a time, so
       we don't need to loop over a list of requests; we'll only get one. */
    
	char string[256];
    switch(reqinfo->mode) {

        case MODE_GET:
	*string = 0;
	GetOneStringFromCommand("/sbin/getsysinfo cputmp", string, sizeof(string));
            snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR,
                                     (u_char *) string/* XXX: a pointer to the scalar's data */,
                                     strlen(string)/* XXX: the length of the data in bytes */);
            break;


        default:
            /* we should never get here, so this is a really bad error */
            snmp_log(LOG_ERR, "unknown mode (%d) in handle_CPU-Temperature\n", reqinfo->mode );
            return SNMP_ERR_GENERR;
    }

    return SNMP_ERR_NOERROR;
}
int
handle_SystemTemperature(netsnmp_mib_handler *handler,
                          netsnmp_handler_registration *reginfo,
                          netsnmp_agent_request_info   *reqinfo,
                          netsnmp_request_info         *requests)
{
    /* We are never called for a GETNEXT if it's registered as a
       "instance", as it's "magically" handled for us.  */

    /* a instance handler also only hands us one request at a time, so
       we don't need to loop over a list of requests; we'll only get one. */
    
	char string[256];
    switch(reqinfo->mode) {

        case MODE_GET:
	*string = 0;
	GetOneStringFromCommand("/sbin/getsysinfo systmp", string, sizeof(string));
            snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR,
                                     (u_char *) string/* XXX: a pointer to the scalar's data */,
                                     strlen(string)/* XXX: the length of the data in bytes */);
            break;


        default:
            /* we should never get here, so this is a really bad error */
            snmp_log(LOG_ERR, "unknown mode (%d) in handle_SystemTemperature\n", reqinfo->mode );
            return SNMP_ERR_GENERR;
    }

    return SNMP_ERR_NOERROR;
}
int
handle_IfNumber(netsnmp_mib_handler *handler,
                          netsnmp_handler_registration *reginfo,
                          netsnmp_agent_request_info   *reqinfo,
                          netsnmp_request_info         *requests)
{
    /* We are never called for a GETNEXT if it's registered as a
       "instance", as it's "magically" handled for us.  */

    /* a instance handler also only hands us one request at a time, so
       we don't need to loop over a list of requests; we'll only get one. */
    
	int value = GetNasNetworkNumber();
    switch(reqinfo->mode) {

        case MODE_GET:
            snmp_set_var_typed_value(requests->requestvb, ASN_INTEGER,
                                     (u_char *) &value/* XXX: a pointer to the scalar's data */,
                                     sizeof(value)/* XXX: the length of the data in bytes */);
            break;


        default:
            /* we should never get here, so this is a really bad error */
            snmp_log(LOG_ERR, "unknown mode (%d) in handle_IfNumber\n", reqinfo->mode );
            return SNMP_ERR_GENERR;
    }

    return SNMP_ERR_NOERROR;
}
int
handle_HdNumber(netsnmp_mib_handler *handler,
                          netsnmp_handler_registration *reginfo,
                          netsnmp_agent_request_info   *reqinfo,
                          netsnmp_request_info         *requests)
{
    /* We are never called for a GETNEXT if it's registered as a
       "instance", as it's "magically" handled for us.  */

    /* a instance handler also only hands us one request at a time, so
       we don't need to loop over a list of requests; we'll only get one. */
    
	int value = GetNasDiskNumber();
    switch(reqinfo->mode) {

        case MODE_GET:
            snmp_set_var_typed_value(requests->requestvb, ASN_INTEGER,
                                     (u_char *) &value/* XXX: a pointer to the scalar's data */,
                                     sizeof(value)/* XXX: the length of the data in bytes */);
            break;


        default:
            /* we should never get here, so this is a really bad error */
            snmp_log(LOG_ERR, "unknown mode (%d) in handle_HdNumber\n", reqinfo->mode );
            return SNMP_ERR_GENERR;
    }

    return SNMP_ERR_NOERROR;
}
int
handle_ModelName(netsnmp_mib_handler *handler,
                          netsnmp_handler_registration *reginfo,
                          netsnmp_agent_request_info   *reqinfo,
                          netsnmp_request_info         *requests)
{
    /* We are never called for a GETNEXT if it's registered as a
       "instance", as it's "magically" handled for us.  */

    /* a instance handler also only hands us one request at a time, so
       we don't need to loop over a list of requests; we'll only get one. */
    
	char string[256];
    switch(reqinfo->mode) {

        case MODE_GET:
	*string = 0;
	GetOneStringFromCommand("/sbin/getsysinfo model", string, sizeof(string));
            snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR,
                                     (u_char *)string /* XXX: a pointer to the scalar's data */,
                                     strlen(string)/* XXX: the length of the data in bytes */);
            break;


        default:
            /* we should never get here, so this is a really bad error */
            snmp_log(LOG_ERR, "unknown mode (%d) in handle_ModelName\n", reqinfo->mode );
            return SNMP_ERR_GENERR;
    }

    return SNMP_ERR_NOERROR;
}
int
handle_HostName(netsnmp_mib_handler *handler,
                          netsnmp_handler_registration *reginfo,
                          netsnmp_agent_request_info   *reqinfo,
                          netsnmp_request_info         *requests)
{
    /* We are never called for a GETNEXT if it's registered as a
       "instance", as it's "magically" handled for us.  */

    /* a instance handler also only hands us one request at a time, so
       we don't need to loop over a list of requests; we'll only get one. */
    
	char string[256];
    switch(reqinfo->mode) {

        case MODE_GET:
	{
        *string = 0;
	FILE *fp = popen("/sbin/getcfg System \"Server Name\" -d \"\"", "r");
	if (fp) {
		fgets(string, sizeof(string), fp);
		fclose(fp);
	}
    	}
            snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR,
                                     (u_char *)string /* XXX: a pointer to the scalar's data */,
                                     strlen(string)/* XXX: the length of the data in bytes */);
            break;


        default:
            /* we should never get here, so this is a really bad error */
            snmp_log(LOG_ERR, "unknown mode (%d) in handle_HostName\n", reqinfo->mode );
            return SNMP_ERR_GENERR;
    }
    return SNMP_ERR_NOERROR;
}
int
handle_SysFanNumber(netsnmp_mib_handler *handler,
                          netsnmp_handler_registration *reginfo,
                          netsnmp_agent_request_info   *reqinfo,
                          netsnmp_request_info         *requests)
{
    /* We are never called for a GETNEXT if it's registered as a
       "instance", as it's "magically" handled for us.  */

    /* a instance handler also only hands us one request at a time, so
       we don't need to loop over a list of requests; we'll only get one. */
	int value = GetSystemFanNumber();
    switch(reqinfo->mode) {

        case MODE_GET:
            snmp_set_var_typed_value(requests->requestvb, ASN_INTEGER,
                                     (u_char *) &value/* XXX: a pointer to the scalar's data */,
                                     sizeof(value)/* XXX: the length of the data in bytes */);
            break;


        default:
            /* we should never get here, so this is a really bad error */
            snmp_log(LOG_ERR, "unknown mode (%d) in handle_SysFanNumber\n", reqinfo->mode );
            return SNMP_ERR_GENERR;
    }
    return SNMP_ERR_NOERROR;
}
int
handle_SysVolumeNumber(netsnmp_mib_handler *handler,
                          netsnmp_handler_registration *reginfo,
                          netsnmp_agent_request_info   *reqinfo,
                          netsnmp_request_info         *requests)
{
    /* We are never called for a GETNEXT if it's registered as a
       "instance", as it's "magically" handled for us.  */

    /* a instance handler also only hands us one request at a time, so
       we don't need to loop over a list of requests; we'll only get one. */
	int value = GetSystemVolumeNumber();
    switch(reqinfo->mode) {

        case MODE_GET:
            snmp_set_var_typed_value(requests->requestvb, ASN_INTEGER,
                                     (u_char *) &value/* XXX: a pointer to the scalar's data */,
                                     sizeof(value)/* XXX: the length of the data in bytes */);
            break;


        default:
            /* we should never get here, so this is a really bad error */
            snmp_log(LOG_ERR, "unknown mode (%d) in handle_SysVolumeNumber\n", reqinfo->mode );
            return SNMP_ERR_GENERR;
    }
    return SNMP_ERR_NOERROR;
}
